# Frontend Architecture (Base Project)

## Module boundaries

- `src/views/*`: page-level composition only.
- `src/service/api/generated/*`: official SDK generated by `@hey-api/openapi-ts` from backend OpenAPI.
- `src/service/api/*`: domain-level API facades built on `request(...)`, providing a stable app-facing API layer while migrating endpoints to generated SDK.
- `src/service/api/generated-adapter.ts`: adapter that normalizes generated SDK responses into existing flat `{ data, error }` flow.
- `src/store/modules/*`: state and orchestration, no direct UI components.
- `src/hooks/business/*`: reusable page/business logic (CRUD, tenant switch, search).
- `src/hooks/common/*`: framework-level generic hooks.

## Access-control flow

- Backend returns menu metadata + route rules.
- Route access is evaluated in `src/store/modules/route/auth-access.ts`.
- UI action visibility (`view/manage`) is handled in page-level auth checks.

## API contract workflow

- Frontend client snapshot: `docs/api-client-contract.snapshot`
- Frontend-to-backend compatibility allowlist: `docs/api-backend-compat.allowlist.json`
- One-command generation: `npm run generate-api` (remote-first OpenAPI input with local fallback)
- Type generation source:
  - `../obsidian-admin-laravel/docs/openapi.yaml`
  - `../obsidian-admin-laravel/docs/api-contract.snapshot`
  - `../obsidian-admin-laravel/app/DTOs`
  - `../obsidian-admin-laravel/app/Http/Resources`

## Maintainability rules

- Keep page files thin by extracting repeated logic to hooks.
- Keep route authorization logic centralized in one module.
- Keep request models centralized in `src/typings/api/*`.
- CI must run lint, typecheck, unit test, and contract gates.

## Scaffolding workflow

- Use `pnpm generate:page` to scaffold a new page module with:
  - `src/views/<page>/index.vue`
  - route i18n keys in `src/locales/langs/en-us.ts` and `src/locales/langs/zh-cn.ts`
  - optional API placeholder files in `src/typings/api/<page>.d.ts` and `src/service/api/<page>.ts`
  - optional route manifest refresh via `pnpm gen-route`

## Standard paginated CRUD hook

- Use `src/hooks/business/crud-paginated-table.ts` as the default wrapper for list pages.
- It standardizes:
  - pagination sync (`current`/`size`)
  - request param normalization
  - loading state (`tableLoading`)
  - optional initial data bootstrap with `useAsyncState`
  - optional unified API error toast handling
